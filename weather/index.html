<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçŸ¥å¤©æ°”</title>
    <style>
        :root {
            --bg-color: #4facfe;
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            margin: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 1s ease;
            background: var(--bg-color);
        }

        .weather-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 28px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            text-align: center;
            width: 350px;
            backdrop-filter: blur(15px);
        }

        /* æœç´¢æ¡† */
        .search-box {
            display: flex;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        input {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            outline: none;
            font-size: 16px;
        }
        button {
            padding: 10px 18px;
            background: #333;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
        }

        /* ä¸»æ˜¾ç¤ºåŒº */
        .city { font-size: 24px; font-weight: bold; color: #333; }
        .main-emoji { font-size: 80px; margin: 10px 0; display: block; }
        .temp-main { font-size: 64px; font-weight: 800; color: #222; margin: 0; }
        .info-main { font-size: 18px; color: #666; margin-bottom: 20px; }

        /* é¢„æŠ¥åŒºåŸŸ */
        .forecast-container {
            border-top: 1px solid rgba(0,0,0,0.08);
            padding-top: 10px;
        }
        .forecast-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 15px;
        }
        .f-date { width: 50px; text-align: left; font-weight: 600; }
        .f-info { flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .f-emoji { font-size: 20px; }
        .f-temp { width: 85px; text-align: right; color: #444; font-weight: bold; }

        /* èƒŒæ™¯ä¸»é¢˜ */
        .theme-sunny { background: linear-gradient(135deg, #FFD166 0%, #F7873F 100%); }
        .theme-cloudy { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        .theme-rain { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-default { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    </style>
</head>
<body id="body">

<div class="weather-card">
    <div class="search-box">
        <input type="text" id="cityInput" placeholder="æœç´¢åŸå¸‚...">
        <button onclick="changeCity()">æœç´¢</button>
    </div>

    <div id="city" class="city">é˜²åŸæ¸¯</div>
    <span id="mainEmoji" class="main-emoji">â˜€ï¸</span>
    <div id="temp" class="temp-main">--Â°</div>
    <div id="text" class="info-main">åŠ è½½ä¸­...</div>

    <div class="forecast-container" id="forecast"></div>
</div>

<script>
    const API_KEY = 'SCwTstrVT1Y5yfS7F'; // è¯·å¡«å…¥ä½ çš„å¿ƒçŸ¥å¤©æ°”ç§é’¥
    const DEFAULT_CITY = 'fangchenggang';

    // å¤©æ°”ä»£ç åˆ° Emoji çš„æ˜ å°„è¡¨
    const emojiMap = {
        "0": "â˜€ï¸", "1": "â˜€ï¸", "2": "â˜€ï¸", "3": "â˜€ï¸",          // æ™´
        "4": "â›…", "5": "â›…", "6": "â›…", "7": "â˜ï¸", "8": "â˜ï¸", "9": "â˜ï¸", // å¤šäº‘/é˜´
        "10": "ğŸŒ§ï¸", "11": "â›ˆï¸", "13": "ğŸŒ§ï¸", "14": "ğŸŒ§ï¸", "15": "ğŸŒ§ï¸",    // é›¨
        "20": "â„ï¸", "21": "â„ï¸", "22": "â„ï¸",                      // é›ª
        "30": "ğŸŒ«ï¸", "31": "ğŸŒ«ï¸",                               // é›¾/éœ¾
        "default": "ğŸŒˆ"
    };

    function getEmoji(code) {
        // æ ¹æ® code å‰å‡ ä½å¤§è‡´åˆ†ç±»æˆ–ç›´æ¥åŒ¹é…
        if (emojiMap[code]) return emojiMap[code];
        if (code >= 10 && code <= 19) return "ğŸŒ§ï¸";
        if (code >= 20 && code <= 25) return "â„ï¸";
        return emojiMap["default"];
    }

    async function fetchWeather(location) {
        const nowUrl = `https://api.seniverse.com/v3/weather/now.json?key=${API_KEY}&location=${encodeURIComponent(location)}&language=zh-Hans&unit=c`;
        const dailyUrl = `https://api.seniverse.com/v3/weather/daily.json?key=${API_KEY}&location=${encodeURIComponent(location)}&language=zh-Hans&unit=c&start=0&days=3`;

        try {
            const [nowRes, dailyRes] = await Promise.all([fetch(nowUrl), fetch(dailyUrl)]);
            const nowData = await nowRes.json();
            const dailyData = await dailyRes.json();

            if (nowData.results && dailyData.results) {
                const now = nowData.results[0].now;
                const loc = nowData.results[0].location;
                
                // æ›´æ–°å½“å‰
                document.getElementById('city').innerText = loc.name;
                document.getElementById('temp').innerText = now.temperature + 'Â°';
                document.getElementById('text').innerText = now.text;
                document.getElementById('mainEmoji').innerText = getEmoji(now.code);
                
                // æ›´æ–°é¢„æŠ¥
                const forecastCont = document.getElementById('forecast');
                forecastCont.innerHTML = '';
                dailyData.results[0].daily.forEach((day, i) => {
                    const label = ["ä»Šå¤©", "æ˜å¤©", "åå¤©"][i];
                    forecastCont.innerHTML += `
                        <div class="forecast-item">
                            <span class="f-date">${label}</span>
                            <div class="f-info">
                                <span class="f-emoji">${getEmoji(day.code_day)}</span>
                                <span>${day.text_day}</span>
                            </div>
                            <span class="f-temp">${day.low}Â° / ${day.high}Â°</span>
                        </div>
                    `;
                });

                updateTheme(now.text);
            }
        } catch (e) { alert("æ•°æ®è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç§é’¥"); }
    }

    function updateTheme(text) {
        const b = document.getElementById('body');
        b.className = '';
        if (text.includes('æ™´')) b.classList.add('theme-sunny');
        else if (text.includes('äº‘') || text.includes('é˜´')) b.classList.add('theme-cloudy');
        else if (text.includes('é›¨')) b.classList.add('theme-rain');
        else b.classList.add('theme-default');
    }

    function changeCity() {
        const input = document.getElementById('cityInput');
        if (input.value) fetchWeather(input.value);
    }

    fetchWeather(DEFAULT_CITY);
</script>
</body>
</html>
